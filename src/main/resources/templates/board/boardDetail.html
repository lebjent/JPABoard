<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout=http://www.ultraq.net.nz/thymeleaf/layout
      layout:decorate="~{layouts/layoutBasic}">
    
    	<th:block layout:fragment="css">
    		<style>
				.board-content{
					margin: 0 auto;
					margin-top: 80px;
					width: 800px;
				}
				
				.form-select{
					width: 140px;
					float: right;
				}
				
				.btn-group{
					float: right;
					margin-top: 30px;
				}
				
			</style>	
    	</th:block> 
      	<th:block layout:fragment="script">
      		<script th:inline="javascript">
				$(document).ready(function(){
					
					//모달실행시 화면밖을 클리시 닫히는 경우를 방지 하기위하여
					$('#confirmModal').modal({backdrop: 'static', keyboard: false}) ;
					
					//게시판 리스트로 돌아가기
					returmBoardList();
					//파일 다운로드
					fileDownload();
					//수정페이지로 이동
					modifyMovePage();
					
					
					//게시판 삭제
					modalConfirm(function(confirm){
						  if(confirm){
							  boardDelete();
						  }else{
							return false;
						  }
					});
					
				})
				//게시판으로 이동
				function returmBoardList(){
					$("#return_btn").on("click",function(){
						let page = $("#page").val();
						location.href="/board/boardList/"+page;
					})
				}
				
				//파일 다운로드
				function fileDownload(){
					$(".file-download").on("click",function(e){
						e.preventDefault();
						let fileName = $(this).data("fn");
						let originalFileName = $(this).data("ofn");
						
						self.location = "/board/fileDownload?originalFileName="+originalFileName+"&fileName="+fileName;
					})
				}
				
				//수정페이지로 이동
				function modifyMovePage(){
					$("#modify_btn").on("click",function(){
						let page = $("#page").val();
						let bno = $("#bno").val();
						
						location.href = "/board/boardModify/"+bno+"?page="+page;
					})
				}
				
				/* Modal콜백 함수 */
				function modalConfirm(callback){
					
					 $("#elision_btn").on("click", function(e){
						 e.preventDefault();
						 $("#confirmModal").modal('show');
					 });
					
					$("#delete_btn").on("click",function(e){
						e.preventDefault();
						$('#confirmModal').modal("hide");
						callback(true);
					})
					
					$('#cancel_btn').click(function(e){
						callback(false);
						e.preventDefault();
						$('#confirmModal').modal("hide");
					});
					
					//모달창 닫기
					$('.close').click(function(e){
						callback(false);
						e.preventDefault();
						$('#confirmModal').modal("hide");
					});
				}
				
				function boardDelete(){
					
					let bno = $("#bno").val();
					
					$("#boardForm").attr("action","/board/boardDelete/"+bno);
					$("#boardForm").submit();
				}
				
			</script>
      	</th:block>
    <div layout:fragment="content">
    	<form role="form" method="post" id="boardForm" action="/board/boardWrite" enctype="multipart/form-data" th:object="${boardFormDTO}">
    	<div class="board-content">
			<div class="p-5 mb-4 bg-light rounded-3">
				<h3>JPA 프로젝트 게시글</h3>
      			<div class="container-fluid py-5">
      				<div class="mb-3">
					  <label for="title" class="form-label">게시글 제목</label>
					  <input type="text" class="form-control" id="title" name="title" th:field="*{title}" readonly="readonly">
					</div>
				    <div class="row">
					    <div class="col">
					    	<div class="input-group mb-3">
  								<span class="input-group-text" id="basic-addon1">작성자</span>
  								<input type="text" class="form-control" name="writer" id="writer" th:field="*{writer}" aria-label="writer" aria-describedby="basic-addon1" readonly>
							</div>
					    </div>
					    <div class="col right">
					    	<select class="form-select" name="viewStatus" th:field="*{viewStatus}" aria-label="form-select-sm example" disabled>
							  <option value="PUBLIC">전체공개</option>
							  <option value="PRIVATE">비공개</option>
							</select>
					    </div>
  					</div>
					<div class="mb-3">
					  <label for="content" class="form-label">게시글 내용</label>
					  <textarea class="form-control" id="content" name="content" th:field="*{content}" rows="8" readonly></textarea>
					</div>
					<div class="mb-3">
						<label for="attach_file" class="form-label">첨부파일</label>
						<div th:if="${not #lists.isEmpty(boardFormDTO.boardFileList)}">
							<div class="form-group" th:each="boardFile, status: ${boardFormDTO.boardFileList}">
								<input type="hidden" name="boardFileFno" th:value="${boardFile.fno}">
								<!-- 오리지널 파일명이 없는경우 체크 -->
								<div th:if="${not #strings.equals(boardFile.originalFileName,null)}">
									<div class="file-download" th:data-ofn="${boardFile.originalFileName}" th:data-fn="${boardFile.fileName}" style="width: 200px;">
										<img alt="disk" th:src="@{/img/disk.png}" style="vertical-align: middle; margin-right: 5px;">
										<a href="#" th:text="${boardFile.originalFileName}"  style="vertical-align: middle;"></a>
									</div>
								</div>
							</div>
						</div>
					</div>
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
					<input type="hidden" id="page" th:value="${page}">
					<input type="hidden" id="bno" th:value="${bno}">
					<div style="float: right;">
						<button type="button" id="return_btn" class="btn btn-primary">메인페이지로 돌아가기</button>
						<button th:if="${userId == boardFormDTO.writer}" type="button" id="modify_btn" class="btn btn-success">수정</button>
						<button th:if="${userId == boardFormDTO.writer}" type="button" id="elision_btn" class="btn btn-danger">삭제</button>
					</div>
      			</div>
      		</div>	
    	</div>
    	</form>
    	
    	<!-- 컨펌 모달 창 -->
		<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		  <div class="modal-dialog modal-dialog-centered" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="confirmTitle">※주의</h5>
		        <div class="close" data-dismiss="modal" aria-label="Close">
		          <img  th:src="@{/img/close.png}">
		        </div>
		      </div>
		      <div class="modal-body" id="modal-confirm">
		      	<p style="font-weight: bold; font-size: 10pt;">게시물 삭제시 복구가 불가능 합니다.</p>
		      	<p style="font-weight: bold; font-size: 10pt;">그래도 정말로 수정하시겠습니까?</p>
		      </div>
		      <div class="modal-footer" id="modal-footer">
		      		<button type='button' id="delete_btn" class='btn btn-danger'>삭제</button>
		      		<button type='button' id="cancel_btn" class='btn btn-secondary'>취소</button>
		      </div>
		    </div>
		  </div>
		</div>
    	
  	</div>
</html>